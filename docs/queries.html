
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>Queries Â· HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 4.0.4">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-theme-api/theme-api.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="example.html" />
    
    
    <link rel="prev" href="configuration.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="getting-started.html">
            
                <a href="getting-started.html">
            
                    
                    Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="getting-started.html">
            
                <a href="getting-started.html#optional-clone-the-repository">
            
                    
                    Clone the repository
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="getting-started.html">
            
                <a href="getting-started.html#optional-setup-the-database">
            
                    
                    Setup the database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="getting-started.html">
            
                <a href="getting-started.html#setup-the-environment">
            
                    
                    Setup the environment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="configuration.html">
            
                <a href="configuration.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="database.html">
            
                <a href="database.html#database">
            
                    
                    Database
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="database.html">
            
                <a href="database.html#database-structure">
            
                    
                    Database structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="database.html">
            
                <a href="database.html#matsim-files-and-tables">
            
                    
                    Matsim files and tables
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="databaseTools.html">
            
                <a href="databaseTools.html#database-tools">
            
                    
                    Database tools
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="databaseTools.html">
            
                <a href="databaseTools.html#createdatabasedatabasename">
            
                    
                    createDatabase()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="databaseTools.html">
            
                <a href="databaseTools.html#selectdatabasedatabasename-verbosetrue">
            
                    
                    selectDatabase()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="databaseTools.html">
            
                <a href="databaseTools.html#executesqlqueryondatabasequerystring">
            
                    
                    executeSQLQueryOnDatabase()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="databaseTools.html">
            
                <a href="databaseTools.html#getalldatabasesprojects">
            
                    
                    getAllDatabasesProjects()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="databaseTools.html">
            
                <a href="databaseTools.html#gettablesfromdatabase">
            
                    
                    getTablesFromDatabase()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="databaseTools.html">
            
                <a href="databaseTools.html#deletetabletablename">
            
                    
                    deleteTable()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="databaseTools.html">
            
                <a href="databaseTools.html#getdatabasetabledataframetablename">
            
                    
                    getDatabaseTableDataframe()
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="converter.html">
            
                <a href="converter.html#converter">
            
                    
                    Converter
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="converter.html">
            
                <a href="converter.html#how-to">
            
                    
                    How to
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="converter.html">
            
                <a href="converter.html#specificities">
            
                    
                    Specificities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="converter.html">
            
                <a href="converter.html#example">
            
                    
                    Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="queries.html">
            
                <a href="queries.html#queries">
            
                    
                    Queries
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="queries.html">
            
                <a href="queries.html#agentactivity">
            
                    
                    agentActivity()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="queries.html">
            
                <a href="queries.html#odmatrix">
            
                    
                    odMatrix()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="queries.html">
            
                <a href="queries.html#activitysequences">
            
                    
                    activitySequences()
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="miscellaneous.html">
            
                <a href="miscellaneous.html#miscellaneous">
            
                    
                    Miscellaneous
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="miscellaneous.html">
            
                <a href="miscellaneous.html#create-geojson-file">
            
                    
                    Create geojson file
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="miscellaneous.html">
            
                <a href="miscellaneous.html#convert-the-epsg-of-a-geojson-file">
            
                    
                    Convert the EPSG of a geojson file
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="example.html">
            
                <a href="example.html">
            
                    
                    Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="documentation.html">
            
                <a href="documentation.html">
            
                    
                    Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="troubleshooting.html">
            
                <a href="troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Queries</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="queries">Queries</h1>
<hr>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> furbain <span class="hljs-keyword">import</span> queries
</code></pre>
<hr>
<h2 id="agentactivity">agentActivity()</h2>
<div class="api-method"><div class="api-method-definition"><p><em>Get dataframes of the activities of agents in each zone during given timespan</em></p>
<pre><code class="lang-python">agentActivity(filePath, startTime=<span class="hljs-string">&apos;00:00:00&apos;</span>, endTime=<span class="hljs-string">&apos;32:00:00&apos;</span>, strictTime=<span class="hljs-literal">False</span>)
</code></pre>
<p><strong>Parameters :</strong></p>
<ul>
<li><code>filepath</code> : Path to the <strong>geojson</strong> file containing the different zones to consider (eg: <a href="https://github.com/gabRpt/matsim-output-postgreSQL-converter/blob/main/resources/sample/5zones.geojson" target="_blank">5zones.geojson</a>)</li>
<li><code>start_time</code> : start time of the timespan (string default: <code>&apos;00:00:00&apos;</code>)</li>
<li><code>end_time</code> : end time of the timespan (string default: <code>&apos;32:00:00&apos;</code>)</li>
<li><p><code>strictTime</code> : (boolean default: <code>False</code>)</p>
<pre><code>  if true, only activities that start and end in the time interval are considered
      eg: an activity starting at 18:30:00 and ending at 19:00:00 is considered
          an activity starting at 18:30:00 and ending at 19:15:00 is NOT considered
          an activity starting at 17:00:00 and ending at 19:00:00 is NOT considered
          an activity starting starting or ending at null is NOT considered

  if false, if an activity starts before the time interval or ends after the time interval, it is considered
      eg: an activity starting at 18:00:00 and ending at xx:xx:xx is considered
          an activity starting at 18:00:00 and ending at null is considered
          an activity starting at 17:00:00 and ending at 18:00:00 or later is considered
          an activity starting at 19:00:00 and ending at xx:xx:xx is NOT considered
</code></pre></li>
</ul>
</div><div class="api-method-code"><div class="api-method-example"><p><strong>Output :</strong></p>
<p>Returns a list of dataframes, one dataframe per zone.</p>
<ul>
<li><code>id</code> : id of the activity</li>
<li><code>type</code> : type of the activity</li>
<li><code>location</code> : location of the activity</li>
<li><code>z</code> : z axis of the location</li>
<li><code>start_time</code> : start time of the activity</li>
<li><code>end_time</code> : end time of the activity</li>
<li><code>max_dur</code> : maximum duration of the activity</li>
<li><code>typeBeforeCutting</code> : type of the activity before cutting</li>
<li><code>linkId</code> : linkId of the activity</li>
<li><code>facilityId</code> : facilityId of the activity</li>
<li><code>personId</code> : id of the agent</li>
<li><code>total_time_spent</code> : total time spent by the person in the activity</li>
<li><code>time_spent_in_interval</code> : time spent by the person in the activity in the interval</li>
</ul>
</div><div class="api-method-example"><p><img src="https://raw.githubusercontent.com/gabRpt/matsim-output-postgreSQL-converter/main/resources/docs/queries/agent_activity_output.png" alt="Agent activity output"></p>
</div></div></div>

<hr>
<h2 id="odmatrix">odMatrix()</h2>
<h5 id="generate-the-od-matrix">Generate the od matrix</h5>
<div class="api-method"><div class="api-method-definition"><p><em>Get od matrix of trips between zones during given timespan</em></p>
<pre><code class="lang-python">odMatrix(filePath, startTime=<span class="hljs-string">&apos;00:00:00&apos;</span>, endTime=<span class="hljs-string">&apos;32:00:00&apos;</span>, ignoreArrivalTime=<span class="hljs-literal">True</span>, generateArabesqueFiles=<span class="hljs-literal">False</span>)
</code></pre>
<p><strong>Parameters :</strong></p>
<ul>
<li><code>filepath</code> : Path to the <strong>geojson</strong> file containing the different zones to consider (eg: <a href="https://github.com/gabRpt/matsim-output-postgreSQL-converter/blob/main/resources/sample/5zones.geojson" target="_blank">5zones.geojson</a>)</li>
<li><code>start_time</code> : start time of the timespan (string default: <code>&apos;00:00:00&apos;</code>)</li>
<li><code>end_time</code> : end time of the timespan (string default: <code>&apos;32:00:00&apos;</code>)</li>
<li><code>ignoreArrivalTime</code> : (boolean default: <code>True</code>)<pre><code>  if true, only startTime is considered
  eg: a trip having dep_time = 18:00:00 and trav_time = 00:30:00 is considered
      a trip having dep_time = 18:00:00 and trav_time = 01:30:00 is NOT considered (arrivalTime = 19:30:00 is not in interval)
  if False:
  eg : a trip having dep_time = 18:00:00 and trav_time = 00:30:00 is considered
          a trip having dep_time = 18:00:00 and trav_time = 01:30:00 is considered
  in both cases, if a trip has a dep_time &lt; 18:00:00 it will not be considered
</code></pre></li>
<li><code>generateArabesqueFiles</code> : if true, generates the files needed to create a scheme in <a href="http://arabesque.ifsttar.fr/" target="_blank">Arabesque</a> (boolean default: <code>False</code>)</li>
</ul>
</div><div class="api-method-code"><div class="api-method-example"><p><strong>Output :</strong></p>
<p>A 2D array.</p>
<p><img src="https://raw.githubusercontent.com/gabRpt/matsim-output-postgreSQL-converter/main/resources/docs/queries/OD_matrix_output.png" alt="OD Matrix output"></p>
</div></div></div>

<h5 id="use-generated-files-in-arabesque">Use generated files in Arabesque</h5>
<div class="api-method"><div class="api-method-definition"><p>If <code>generateArabesqueFiles</code> is set to true, the files needed to create a scheme in <a href="http://arabesque.ifsttar.fr/" target="_blank">Arabesque</a> are generated in the folder <code>/output</code>.
You will get 2 files :</p>
<ul>
<li><code>flow.csv</code> : contains the od matrix of the trips between zones</li>
<li><code>location.csv</code> : contains the zones with their coordinates</li>
</ul>
<p><em><strong>A detailed documentation on how to create a scheme in Arabesque can be found <a href="https://gflowiz.github.io/arabesque/" target="_blank">here</a>.</strong></em></p>
</div><div class="api-method-code"></div></div>

<hr>
<h2 id="activitysequences">activitySequences()</h2>
<div class="api-method"><div class="api-method-definition"><p><em>Get the activity sequences of agents during given timespan and zone</em></p>
<pre><code class="lang-python">activitySequences(filePath, startTime=<span class="hljs-string">&apos;00:00:00&apos;</span>, endTime=<span class="hljs-string">&apos;32:00:00&apos;</span>, interval=<span class="hljs-number">15</span>, batchSize=<span class="hljs-number">10</span>, createTableInDatabase=<span class="hljs-literal">False</span>, nbAgentsToProcess=-<span class="hljs-number">1</span>)
</code></pre>
<p><strong>Parameters :</strong></p>
<ul>
<li><code>filepath</code> : Path to the <strong>geojson</strong> file containing <strong>only one</strong> zone consider (eg: <a href="https://github.com/gabRpt/matsim-output-postgreSQL-converter/blob/main/resources/sample/1zone.geojson" target="_blank">1zone.geojson</a>)</li>
<li><code>start_time</code> : start time of the timespan (string default: <code>&apos;00:00:00&apos;</code>)</li>
<li><code>end_time</code> : end time of the timespan (string default: <code>&apos;32:00:00&apos;</code>)</li>
<li><code>interval</code> : interval of time between each sequence (in minutes =&gt; int default: <code>15</code>)</li>
<li><code>batchSize</code> : number of agents to consider in each batch to optimize multiprocessing (has to be &gt; 0, int default: <code>10</code>)</li>
<li><code>createTableInDatabase</code> : if true, creates a table in the database with the activity sequences, the name of the table can be defined in the config file (boolean default: <code>False</code>)</li>
<li><code>nbAgentsToProcess</code> : number of agents to process, if set at 100 it will process the first 100 agents. If set at -1 it will process all agents (int default: <code>-1</code>)</li>
</ul>
</div><div class="api-method-code"><div class="api-method-example"><p><strong>Output :</strong></p>
<p>Returns a dataframe with all the activity sequences of all the agents that have <strong>at least one</strong> activity in the given zone during the given timespan.
The dataframe has the following columns :</p>
<ul>
<li><code>agentId</code> : id of the agent</li>
<li><code>periodStart</code> : start time of the current period</li>
<li><code>periodEnd</code> : end time of the current period</li>
<li><code>mainActivityId</code> : id of the activity the agent spent the most time in during the current period</li>
<li><code>startActivityId</code> : id of the first activity of the agent during the current period</li>
<li><code>endActivityId</code> : id of the last activity of the agent during the current period</li>
<li><code>mainActivityStartTime</code> : start time of the activity the agent spent the most time in during the current period</li>
<li><code>mainActivityEndTime</code> : end time of the activity the agent spent the most time in during the current period</li>
<li><code>timeSpentInMainActivity</code> : time spent by the agent in the activity the agent spent the most time in during the current period</li>
</ul>
</div></div></div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            

        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Queries","level":"1.7","depth":1,"next":{"title":"Example","level":"1.9","depth":1,"path":"example.md","ref":"example.md","articles":[]},"previous":{"title":"Configuration","level":"1.3","depth":1,"path":"configuration.md","ref":"configuration.md","articles":[]},"articles":[{"title":"agentActivity()","level":"1.7.1","depth":2,"anchor":"#agentactivity","path":"queries.md","ref":"queries.md#agentactivity","articles":[]},{"title":"odMatrix()","level":"1.7.2","depth":2,"anchor":"#odmatrix","path":"queries.md","ref":"queries.md#odmatrix","articles":[]},{"title":"activitySequences()","level":"1.7.3","depth":2,"anchor":"#activitysequences","path":"queries.md","ref":"queries.md#activitysequences","articles":[]}],"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["theme-api"],"pluginsConfig":{"theme-api":{"languages":[],"split":true,"theme":"light"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"queries.md","mtime":"2023-03-20T13:43:02.555Z","type":"markdown"},"gitbook":{"version":"4.0.4","time":"2023-03-24T15:13:54.198Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-theme-api/theme-api.js"></script>
        
    

    </body>
</html>

